CODE SEGMENT
	ASSUME CS:CODE
START:
	CALL SET;设置工作方式
	
	MOV AX, 100
	MOV DX, 0602H
	OUT DX, AL
	MOV AL, AH
	OUT DX, AL
	MOV BX, 0
MLOOP:
	MOV AL, BL
	MOV DX, 0642H
	OUT DX, AL
	JMP MLOOP
	
SET PROC NEAR
	; 8255 控制字
    MOV DX, 0646H
    MOV AL, 90H
    OUT DX, AL

	MOV DX, 0606H ;使 计数器0 工作在 方式3
	MOV AL, 36H
	OUT DX, AL
	
	MOV DX, 0606H ;使 计数器1 工作在 方式3
	MOV AL, 76H
	OUT DX, AL
	
	MOV DX, 0600H ;让 计数器0 开始工作，计数初值为 4800H
	MOV AX, 4800H
	OUT DX, AL
	MOV AL, AH
	OUT DX, AL
	
	CLI ; 8259 INIT
	MOV AL, 13H
	MOV DX, 0020H
	OUT DX, AL
	MOV AL, 08H
	MOV DX, 0021H
	OUT DX, AL
	MOV AL, 03H
	OUT DX, AL
	MOV AL, 2FH
	OUT DX, AL
	STI
	
	; INTP6 中断向量  
    CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, 38H
	MOV AX, OFFSET INTP6
	CLD
	STOSW
	MOV AX, SEG INTP6
	STOSW
	STI
	
	RET
SET ENDP

; 中断服务程序        
INTP6 PROC FAR
	CMP BL, 0
	JNZ LEFT
	INC BL
	JMP INTPRET   
LEFT:  ;再点亮左边的一个  
    CMP BL, 0FFH
    JZ INTPRET
    SHL BL, 1
    INC BL
INTPRET:	
	IRET
INTP6 ENDP 

CODE ENDS
	END START