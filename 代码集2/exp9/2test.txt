A8255 EQU 0600H
B8255 EQU 0602H
C8255 EQU 0604H
CON8255 EQU 0606H
DATA SEGMENT
TAB:
	DB 3FH,06H,5BH,4FH
	DB 66H,6DH,7DH,07H
	DB 7FH,6FH,77H,7CH
	DB 39H,5EH,79H,71H
TAB1:
	DB 11101110B
	DB 11101101B
	DB 11101011B
	DB 11100111B
	DB 11011110B
	DB 11011101B
	DB 11011011B
	DB 11010111B
	DB 10111110B
	DB 10111101B
	DB 10111011B
	DB 10110111B
	DB 01111110B
	DB 01111101B
	DB 01111011B
	DB 01110111B
TMP DB 10111111B
LIST DB 00H
STAT DB 00000001B
DATA ENDS
CODE SEGMENT
	ASSUME CS:CODE,DS:DATA

START:
	PUSH DS
	MOV AX,0
	PUSH AX
	MOV AX,DATA
	MOV DS,AX
	
	MOV DX,CON8255
	MOV AL,81H
	OUT DX,AL
	
	MOV DX,B8255
	MOV AL,00H
	OUT DX,AL
	
	MOV DX,A8255
	OUT DX,AL
	
AA1:   
	;MOV AL,0FFH
	;MOV DX,A8255
	;OUT DX,AL  
	
    CALL SHOW
    MOV DX,B8255
	MOV AL,00H
	OUT DX,AL
    ;CALL DELAY
	MOV DX,A8255
	MOV AL,00H
	OUT DX,AL
	MOV DX,C8255
	IN AL,DX
	;MOV DX,B8255
	;OUT DX,AL
	AND AL,0FH
	CMP AL,0FH
	JE AA1
	CALL DELAY
	;CALL DELAY
	MOV DX,A8255
	MOV AL,00H
	OUT DX,AL
	MOV DX,C8255
	IN AL,DX
	AND AL,0FH
	CMP AL,0FH
	JE AA1  
	CALL DELAY
	PUSH AX
	MOV AH,11111110B
	MOV CX,4
AA2:
	MOV DX,A8255
	MOV AL,AH
	OUT DX,AL
	MOV DX,C8255
	IN AL,DX
	AND AL,0FH
	CMP AL,0FH
	JNE AA3
	ROL AH,1
	LOOP AA2
	MOV AX,80H
	JMP ENDD
AA3:
	;MOV BH,AH
	AND AH,0FH
	MOV BL,AH
	;ROL BL,1
	;ROL BL,1
	;ROL BL,1
	;ROL BL,1
	POP AX
	SHL AL,1
	SHL AL,1
	SHL AL,1
	SHL AL,1
	OR BL,AL
	;JMP AA1
	;SHL AH,4
	;OR AL,AH
	MOV AL,BL
	LEA BX,TAB1
	MOV CL,0
AA4:
	CMP AL,[BX]
	JE AA5
	INC CL
	INC BX
	CMP CL,10H
	JNZ AA4     
	;MOV AH,0FFH
	JMP ENDD
	
AA5:
	;MOV AH,CL   
	CMP CL,0FH  
	JE ENDD
	CALL INLIST 
AA6:  
    MOV BL,[TMP] 
	MOV CL,[STAT] 
	CMP CL,1
	JE AA7
	JMP AA8
AA7:            
    MOV [STAT],1
    ROR BL,1
    CMP BL,01111111B
    JE AA8
    JMP AA9   
AA8:
    MOV [STAT],0
    ROL BL,1
    CMP BL,10111111B
    JE AA7
AA9:
    MOV [TMP],BL    
AA10:	
	CALL SHOW
	;CALL DELAY
	MOV DX,A8255
	MOV AL,00H
	OUT DX,AL
	MOV DX,C8255
	IN AL,DX
	;MOV DX,B8255
	;OUT DX,AL
	AND AL,0FH
	CMP AL,0FH
	JNE AA10
	;CALL DELAY   
	JMP AA1
	

INLIST:  
	LEA BX,LIST
	AND CX,000FH
	MOV SI,CX
	PUSH BX
	LEA BX,TAB
	MOV DL,[BX+SI]
	POP BX 
	MOV [BX],DL   
	RET

SHOW:
	;PUSH AX
	;PUSH DX
	;CALL DELAY
	MOV AL,[TMP]  
    MOV DX,A8255
    OUT DX,AL
    
    MOV AL,[LIST]
    MOV DX,B8255
    OUT DX,AL 
    CALL DELAY
    ;POP DX
    ;POP AX
    
    
    RET
	

DELAY:
	PUSH CX
	MOV CX,0FFFH
TT:	
	LOOP TT
	POP CX
	RET
ENDD:
	MOV AL,0FFH
	MOV DX,B8255
	OUT DX,AL
    ;MOV AH,00H
    INT 20H
CODE ENDS
END START